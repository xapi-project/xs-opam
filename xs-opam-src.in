Name: xs-opam-src
Version: @VERSION@
Release: 1%{?dist}
Summary: Opam repository
License: Various
URL: @REPO@
# Git commit @RELEASE@
AutoReqProv: no

Source000: @REPO@/archive/%{version}/xs-opam-%{version}.tar.gz
# sources.spec

BuildRequires: opam
BuildRequires: rsync
BuildRequires: ruby

%description
Opam repository containing all upstream and development libraries
required for building the OCaml components in the XS Toolstack.

%prep
%setup -q -n xs-opam-%{version}
# link all source files into build/src/
mkdir -p build/src
./utils/sources.rb -m "@MIRROR@" @URL@ | while read p url
do
  file=$(basename $url)
  (cd build/src; test -f $file || ln -s ../../../../SOURCES/$file .)
done

%build
make repo

%install
mkdir -p %{buildroot}/usr/share/opam-repository
(cd build && rsync -avz  archives packages %{buildroot}/usr/share/opam-repository/)
chmod o+w -R %{buildroot}/usr/share/opam-repository

# create opam root
mkdir -p %{buildroot}/usr/lib/opamroot
chmod 777 %{buildroot}/usr/lib/opamroot


%files
/usr/share/opam-repository
/usr/lib/opamroot
%attr(777, root, wheel) /usr/lib/opamroot

%changelog
* Thu Feb 02 2017 Christian Lindig <christian.lindig@citrix.com> - 0.1.1-1
- This file is auto-generated and the changelog currently does not
  reflect the changes.
* Tue Dec 20 2016 Christian Lindig <christian.lindig@citrix.com> - 0.0.1-1
- Initial version

